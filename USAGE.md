# 快速使用指南

## 🚀 快速开始

### 方法一：使用交互式脚本（推荐）
```bash
python run_crawler.py
```
然后按照提示输入URL和页数即可。

### 方法二：直接运行主程序
```bash
python screenshot_crawler.py
```
这将使用配置文件中的默认设置。

### 方法三：在代码中使用
```python
from screenshot_crawler import ScreenshotCrawler

# 创建爬虫实例
crawler = ScreenshotCrawler()

# 开始截图任务
success_count, screenshot_files = crawler.start_screenshot_task(
    url="https://example.com/your-target-page",
    max_pages=5
)

print(f"成功截图 {success_count} 张")
```

## 📁 文件说明

- `run_crawler.py` - 🎯 **主要运行脚本**（最简单的使用方式）
- `screenshot_crawler.py` - 核心爬虫代码
- `config.py` - 配置文件
- `utils.py` - 工具函数
- `screenshots/` - 截图保存目录
- `logs/` - 日志文件目录

## ⚙️ 配置说明

可以在 `config.py` 中修改以下设置：

```python
# 浏览器配置
BROWSER_WINDOW_SIZE = (1920, 1080)  # 窗口大小
BROWSER_WAIT_TIME = 3               # 页面加载等待时间

# 截图配置
SCREENSHOT_DIR = "screenshots"      # 保存目录
MAX_PAGES = 50                     # 最大翻页数

# 重试配置
MAX_RETRY_TIMES = 3                # 最大重试次数
RETRY_DELAY = 2                    # 重试延迟
```

## 🔧 自定义下一页元素

翻页功能会查找指定ID元素下的第一个A标签：

```python
NEXT_PAGE_SELECTOR = "cal"  # 元素的ID
```

**工作原理**：
1. 查找ID为"cal"的元素：`document.getElementById("cal")`
2. 在该元素内查找第一个可点击的A标签
3. 智能过滤：确保A标签可见、有效、未禁用
4. 点击找到的A标签进行翻页

**智能过滤条件**：
- ✅ A标签可见 (`offsetParent !== null`)
- ✅ 有有效的href属性  
- ✅ 未被禁用 (`!disabled`)
- ✅ 显示状态正常 (`display !== 'none'`)

## 📸 截图命名规则

截图将自动按照以下规则命名：
- `1.png` - 第一张截图
- `2.png` - 第二张截图
- `3.png` - 第三张截图
- ...以此类推

每次运行程序，会自动从最大编号+1开始命名新的截图。

## 🐛 常见问题

### 1. 浏览器启动失败
- 确保已安装Chrome浏览器
- 检查是否有其他程序占用Chrome

### 2. 页面加载失败
- 检查网络连接
- 确认URL是否正确
- 可能需要先手动登录系统

### 3. 找不到下一页元素
- 检查页面是否真的有下一页
- 确认元素ID是否正确（默认为"cal"）

## 📊 日志查看

程序运行时会在控制台显示详细日志，同时也会保存到 `logs/crawler.log` 文件中。

## 🔐 智能登录检测功能

程序会智能判断登录状态并自动处理：

### 🎯 智能检测逻辑

1. **优先检测已登录状态**: 检测页面是否包含"考勤"、"打卡"、"签到"等关键词
   - ✅ 如果检测到 → 直接开始截图任务

2. **检测登录页面**: 检测是否包含登录相关关键词
   - 🔍 查找用户名输入框
   - ✅ 找不到输入框 → 认为已登录，直接开始截图
   - 🔐 找到输入框 → 执行自动登录流程

3. **自动登录流程**（仅在需要时执行）:
   - **精确定位用户名框**: 优先使用 `id="username"` 定位输入框
   - **自动输入用户名**: 会自动填入配置的用户名
   - **等待手动输入密码**: 暂停20秒让您在浏览器中输入密码
   - **自动点击登录按钮**: 智能查找并点击登录按钮
   - **等待页面跳转**: 监控登录状态，检测到成功后立即继续
   - **开始截图任务**: 登录完成后自动开始截图

### 📋 不同情况的流程示例：

#### 情况1: 已在考勤页面（最优情况）
```
🔍 检查是否需要登录...
✅ 检测到已在考勤页面，无需登录
📸 开始截图任务...
```

#### 情况2: 检测到已登录状态
```
🔍 检查是否需要登录...
🔍 检测到登录相关内容，检查是否需要登录...
✅ 未检测到登录输入框，认为已经登录成功
🚀 直接开始截图任务...
```

#### 情况3: 需要完整登录流程
```
🔍 检查是否需要登录...
🔍 检测到登录相关内容，检查是否需要登录...
✅ 已自动输入用户名: your_username
🔐 请在浏览器中手动输入密码
⏰ 程序将等待 20 秒...
💡 输入密码后，程序将自动点击登录按钮
⏳ 等待输入密码... 剩余 15 秒
⏰ 等待时间结束，开始查找登录按钮...
✅ 成功点击登录按钮
🔄 等待页面跳转... 3/10
🎉 登录成功！页面已跳转到目标页面
📸 开始截图任务...
```

### 🎯 智能登录按钮查找

程序会按以下优先级查找登录按钮：
1. `input[type="submit"]` - 提交按钮
2. `button[type="submit"]` - 提交类型按钮
3. 包含"登录"或"Login"文字的按钮
4. class或id包含"login"的元素
5. 如果找不到按钮，会尝试按回车键提交

## 🔗 点击第一个A标签功能

新增强大的A标签点击功能，支持多种使用场景：

### 📋 功能特性
- 🎯 **智能查找**: 自动查找页面中第一个可点击的A标签
- 🔍 **智能过滤**: 排除隐藏、禁用和无效的A标签
- 📊 **详细信息**: 显示找到的A标签的href、文字、ID等信息
- 🖱️  **自动点击**: 使用JavaScript安全点击A标签

### 🔧 使用方式

#### 1. 翻页功能（已内置）
翻页功能已内置为查找cal元素下的第一个A标签：
```python
NEXT_PAGE_SELECTOR = "cal"  # 程序会在cal元素内查找第一个A标签
```

#### 2. 登录后自动点击
在 `config.py` 中设置：
```python
CLICK_FIRST_A_AFTER_LOGIN = True  # 登录后自动点击第一个A标签
```

#### 3. 代码中手动调用
```python
with ScreenshotCrawler() as crawler:
    crawler._initialize_browser()
    crawler._navigate_to_url("your_url")
    success = crawler.click_first_a_tag()  # 手动点击第一个A标签
```

#### 4. 独立测试功能
```bash
python demo_click_a_tag.py
```

### 🎯 智能过滤条件
程序会确保找到的A标签满足以下条件：
- ✅ 可见 (`offsetParent !== null`)
- ✅ 有有效的href属性
- ✅ 未被禁用 (`!disabled`)
- ✅ 显示状态正常 (`display !== 'none'`)

## 🛡️ 注意事项

1. **自动登录**：程序会自动输入配置的用户名，您只需手动输入密码
2. **等待时间**：登录等待时间为20秒，可在 `config.py` 中修改 `LOGIN_WAIT_TIME`
3. **网络稳定**：确保网络连接稳定
4. **磁盘空间**：确保有足够的磁盘空间保存截图
5. **合规使用**：请遵守相关网站的使用条款 